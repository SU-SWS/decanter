services:
  node:
    image: tugboatqa/httpd
    checkout: true
    commands:
      # Used in the base image as setup.
      init:
        - ln -snf "${TUGBOAT_ROOT}/dev/dist" "${DOCROOT}"
        - |
          sudo apt-get install g++ build-essential
          curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash
          NVM_DIR="$HOME/.nvm"
          [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
          nvm install 14.5.0
          nvm use
          npm install

      # Used in each of the preview builds.
      build:
        - |
          NVM_DIR="$HOME/.nvm"
          [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
          nvm use
          touch dev/src/test.css
          touch dev/src/test.js
          cp dev/src/sample.test.html dev/src/test.html
          npm run build:dev

    # Collection of urls to compare visual results.
    visualdiffs:
      - /
